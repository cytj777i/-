local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")

-- 创建声明横幅
local function createDisclaimer()
    local disclaimerGui = Instance.new("ScreenGui")
    disclaimerGui.Name = "DisclaimerGui"
    disclaimerGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    disclaimerGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    
    local disclaimerFrame = Instance.new("Frame")
    disclaimerFrame.Size = UDim2.new(0.6, 0, 0, 80)
    disclaimerFrame.Position = UDim2.new(0.2, 0, 0.1, 0)
    disclaimerFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    disclaimerFrame.BorderSizePixel = 0
    disclaimerFrame.Parent = disclaimerGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = disclaimerFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(80, 80, 80)
    stroke.Thickness = 2
    stroke.Parent = disclaimerFrame
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, -20, 1, -20)
    textLabel.Position = UDim2.new(0, 10, 0, 10)
    textLabel.Text = "本脚本完全免费，禁止贩卖！\n用我脚本圈钱的全家死光！\n作者：XTTT"
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.BackgroundTransparency = 1
    textLabel.Font = Enum.Font.GothamBold
    textLabel.TextSize = 16
    textLabel.TextWrapped = true
    textLabel.TextYAlignment = Enum.TextYAlignment.Center
    textLabel.Parent = disclaimerFrame
    
    -- 5秒后淡出消失
    wait(5)
    
    for i = 1, 10 do
        disclaimerFrame.BackgroundTransparency = i/10
        textLabel.TextTransparency = i/10
        stroke.Transparency = i/10
        wait(0.1)
    end
    
    disclaimerGui:Destroy()
end

-- 兼容性检查：确保必要函数存在
if not getgenv then
    getgenv = function()
        return _G
    end
end

-- 安全执行函数
local function protectedCall(func, ...)
    local success, result = pcall(func, ...)
    if not success then
        warn("执行错误: " .. tostring(result))
    end
    return success, result
end

local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

if not getgenv().Network then
    getgenv().Network = {
        BaseParts = {},
        Velocity = Vector3.new(14.46262424, 14.46262424, 14.46262424)
    }

    Network.RetainPart = function(Part)
        if typeof(Part) == "Instance" and Part:IsA("BasePart") and Part:IsDescendantOf(Workspace) then
            table.insert(Network.BaseParts, Part)
            protectedCall(function()
                Part.CustomPhysicalProperties = PhysicalProperties.new(0, 0, 0, 0, 0)
                Part.CanCollide = false
            end)
        end
    end

    local function EnablePartControl()
        protectedCall(function()
            LocalPlayer.ReplicationFocus = Workspace
        end)
        
        RunService.Heartbeat:Connect(function()
            protectedCall(function()
                sethiddenproperty(LocalPlayer, "SimulationRadius", math.huge)
                for _, Part in pairs(Network.BaseParts) do
                    if Part:IsDescendantOf(Workspace) then
                        Part.Velocity = Network.Velocity
                    end
                end
            end)
        end)
    end

    EnablePartControl()
end

local function ForcePart(v)
    if v:IsA("Part") and not v.Anchored and not v.Parent:FindFirstChild("Humanoid") and not v.Parent:FindFirstChild("Head") and v.Name ~= "Handle" then
        for _, x in next, v:GetChildren() do
            if x:IsA("BodyAngularVelocity") or x:IsA("BodyForce") or x:IsA("BodyGyro") or x:IsA("BodyPosition") or x:IsA("BodyThrust") or x:IsA("BodyVelocity") or x:IsA("RocketPropulsion") then
                protectedCall(function() x:Destroy() end)
            end
        end
        if v:FindFirstChild("Attachment") then
            protectedCall(function() v:FindFirstChild("Attachment"):Destroy() end)
        end
        if v:FindFirstChild("AlignPosition") then
            protectedCall(function() v:FindFirstChild("AlignPosition"):Destroy() end)
        end
        if v:FindFirstChild("Torque") then
            protectedCall(function() v:FindFirstChild("Torque"):Destroy() end)
        end
        
        protectedCall(function()
            v.CanCollide = false
            
            -- 给零件一个随机的爆炸力
            local randomForce = Instance.new("BodyVelocity", v)
            randomForce.Velocity = Vector3.new(
                math.random(-100, 100),
                math.random(50, 100),  -- 向上多一些力
                math.random(-100, 100)
            )
            randomForce.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            
            -- 添加随机旋转
            local randomTorque = Instance.new("BodyAngularVelocity", v)
            randomTorque.AngularVelocity = Vector3.new(
                math.random(-20, 20),
                math.random(-20, 20),
                math.random(-20, 20)
            )
            randomTorque.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
            
            -- 5秒后删除物理效果
            delay(5, function()
                if randomForce and randomForce.Parent then
                    protectedCall(function() randomForce:Destroy() end)
                end
                if randomTorque and randomTorque.Parent then
                    protectedCall(function() randomTorque:Destroy() end)
                end
            end)
        end)
    end
end

local StarterGui = game:GetService("StarterGui")
local TextChatService = game:GetService("TextChatService")

-- 创建GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SuperRingPartsGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- 使用深色主题
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 250, 0, 200)
MainFrame.Position = UDim2.new(0.5, -125, 0.5, -100)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30) -- 深灰色背景
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

-- 使GUI圆角
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- 添加边框效果
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(80, 80, 80)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "零件破坏者 v2.0"
Title.TextColor3 = Color3.fromRGB(255, 255, 255) -- 白色文字
Title.BackgroundColor3 = Color3.fromRGB(45, 45, 45) -- 稍浅的深灰色
Title.Font = Enum.Font.GothamBold -- 现代字体
Title.TextSize = 18
Title.Parent = MainFrame

-- 标题圆角
local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = Title

local BreakButton = Instance.new("TextButton")
BreakButton.Size = UDim2.new(0.8, 0, 0, 40)
BreakButton.Position = UDim2.new(0.1, 0, 0.3, 0)
BreakButton.Text = "开启破坏"
BreakButton.BackgroundColor3 = Color3.fromRGB(220, 0, 0) -- 红色按钮
BreakButton.TextColor3 = Color3.fromRGB(255, 255, 255) -- 白色文字
BreakButton.Font = Enum.Font.GothamBold
BreakButton.TextSize = 16
BreakButton.Parent = MainFrame

-- 破坏按钮圆角
local BreakCorner = Instance.new("UICorner")
BreakCorner.CornerRadius = UDim.new(0, 8)
BreakCorner.Parent = BreakButton

-- 按钮悬停效果
BreakButton.MouseEnter:Connect(function()
    if BreakButton.Text == "开启破坏" then
        BreakButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50) -- 更亮的红色
    else
        BreakButton.BackgroundColor3 = Color3.fromRGB(50, 220, 50) -- 更亮的绿色
    end
end)

BreakButton.MouseLeave:Connect(function()
    if BreakButton.Text == "开启破坏" then
        BreakButton.BackgroundColor3 = Color3.fromRGB(220, 0, 0) -- 恢复红色
    else
        BreakButton.BackgroundColor3 = Color3.fromRGB(0, 180, 0) -- 恢复绿色
    end
end)

local Watermark = Instance.new("TextLabel")
Watermark.Size = UDim2.new(1, 0, 0, 20)
Watermark.Position = UDim2.new(0, 0, 1, -25)
Watermark.Text = "脚本作者 XTTT"
Watermark.TextColor3 = Color3.fromRGB(180, 180, 180) -- 浅灰色文字
Watermark.BackgroundTransparency = 1
Watermark.Font = Enum.Font.Gotham
Watermark.TextSize = 12
Watermark.Parent = MainFrame

-- 添加状态指示器
local StatusIndicator = Instance.new("Frame")
StatusIndicator.Size = UDim2.new(0, 10, 0, 10)
StatusIndicator.Position = UDim2.new(0.05, 0, 0.75, 0)
StatusIndicator.BackgroundColor3 = Color3.fromRGB(220, 0, 0) -- 红色表示关闭
StatusIndicator.Parent = MainFrame

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(1, 0)
StatusCorner.Parent = StatusIndicator

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(0, 80, 0, 20)
StatusLabel.Position = UDim2.new(0.15, 0, 0.73, 0)
StatusLabel.Text = "状态: 关闭"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 12
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = MainFrame

-- 添加最小化按钮
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 25, 0, 25)
MinimizeButton.Position = UDim2.new(1, -30, 0, 5)
MinimizeButton.Text = "-"
MinimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60) -- 深灰色
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255) -- 白色
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = 16
MinimizeButton.Parent = MainFrame

-- 最小化按钮圆角
local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 12)
MinimizeCorner.Parent = MinimizeButton

-- 最小化功能
local minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        MainFrame:TweenSize(UDim2.new(0, 250, 0, 40), "Out", "Quad", 0.3, true)
        MinimizeButton.Text = "+"
        BreakButton.Visible = false
        Watermark.Visible = false
    StatusIndicator.Visible = false
        StatusLabel.Visible = false
    else
        MainFrame:TweenSize(UDim2.new(0, 250, 0, 200), "Out", "Quad", 0.3, true)
        MinimizeButton.Text = "-"
        BreakButton.Visible = true
        Watermark.Visible = true
        StatusIndicator.Visible = true
        StatusLabel.Visible = true
    end
end)

-- 使GUI可拖动
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- 添加状态变量
local isEnabled = false

-- 按钮功能
BreakButton.MouseButton1Click:Connect(function()
    -- 切换状态
    isEnabled = not isEnabled
    
    -- 根据状态改变按钮颜色和文本
    if isEnabled then
        BreakButton.BackgroundColor3 = Color3.fromRGB(0, 180, 0) -- 绿色表示开启
        BreakButton.Text = "关闭破坏"
        StatusIndicator.BackgroundColor3 = Color3.fromRGB(0, 220, 0) -- 绿色状态指示
        StatusLabel.Text = "状态: 开启"
        
        -- 对工作空间中的所有零件应用ForcePart函数
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("Part") and not obj.Anchored and not obj.Parent:FindFirstChild("Humanoid") and not obj.Parent:FindFirstChild("Head") and obj.Name ~= "Handle" then
                ForcePart(obj)
            end
        end
        
        StarterGui:SetCore("SendNotification", {
            Title = "零件破坏者",
            Text = "破坏功能已开启！零件正在崩飞！",
            Duration = 3
        })
    else
        BreakButton.BackgroundColor3 = Color3.fromRGB(220, 0, 0) -- 红色表示关闭
        BreakButton.Text = "开启破坏"
        StatusIndicator.BackgroundColor3 = Color3.fromRGB(220, 0, 0) -- 红色状态指示
        StatusLabel.Text = "状态: 关闭"
        
        StarterGui:SetCore("SendNotification", {
            Title = "零件破坏者",
            Text = "破坏功能已关闭",
            Duration = 3
        })
    end
end)

-- 发送启动通知
StarterGui:SetCore("SendNotification", {
    Title = "零件破坏者",
    Text = "脚本已加载，准备破坏零件",
    Duration = 5
})

-- 添加自动检测并破坏新零件的功能
local function autoDetectAndBreakParts()
    Workspace.DescendantAdded:Connect(function(descendant)
        if isEnabled and descendant:IsA("Part") and not descendant.Anchored and 
           not descendant.Parent:FindFirstChild("Humanoid") and 
           not descendant.Parent:FindFirstChild("Head") and 
           descendant.Name ~= "Handle" then
            -- 稍等片刻确保零件完全加载
            wait(0.1)
            ForcePart(descendant)
        end
    end)
end

-- 启动自动检测
autoDetectAndBreakParts()

-- 显示声明横幅
createDisclaimer()